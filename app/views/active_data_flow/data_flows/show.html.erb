<div style="max-width: 800px; margin: 0 auto; padding: 20px;">
  <h1>Data Flow: <%= @data_flow.name %></h1>

  <div style="margin-bottom: 20px;">
    <%= link_to "â† Back to Data Flows", "/active_data_flow/data_flows" %>
    |
    <%= link_to "ðŸ“Š View Runs", "/active_data_flow/data_flows/#{@data_flow.id}/data_flow_runs", style: "color: #3182ce; font-weight: 600;" %>
  </div>

  <div style="background-color: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <div style="margin-bottom: 15px;">
      <strong>Name:</strong> <%= @data_flow.name %>
    </div>
    
    <div style="margin-bottom: 15px;">
      <strong>Status:</strong>
      <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; <%= @data_flow.status == 'active' ? 'background-color: #d1fae5; color: #065f46;' : 'background-color: #fee2e2; color: #991b1b;' %>">
        <%= @data_flow.status.upcase %>
      </span>
    </div>

    <div style="margin-bottom: 15px;">
      <strong>Last Run:</strong> <%= @data_flow.last_run_at ? @data_flow.last_run_at.strftime('%Y-%m-%d %H:%M:%S UTC') : 'Never' %>
    </div>

    <div style="margin-bottom: 15px;">
      <strong>Last Error:</strong> <%= @data_flow.last_error || 'None' %>
    </div>

    <div style="margin-bottom: 15px;">
      <strong>Created:</strong> <%= @data_flow.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') %>
    </div>

    <div style="margin-bottom: 15px;">
      <strong>Updated:</strong> <%= @data_flow.updated_at.strftime('%Y-%m-%d %H:%M:%S UTC') %>
    </div>

    <div style="margin-bottom: 15px;">
      <strong>Total Runs:</strong> <%= @data_flow.data_flow_runs.count %>
      <span style="margin-left: 10px; color: #059669;">
        (<%= @data_flow.data_flow_runs.where(status: 'success').count %> success,
        <%= @data_flow.data_flow_runs.where(status: 'failed').count %> failed,
        <%= @data_flow.data_flow_runs.where(status: 'pending').count %> pending)
      </span>
    </div>
  </div>

  <!-- Recent Runs Section -->
  <% recent_runs = @data_flow.data_flow_runs.order(created_at: :desc).limit(5) %>
  <% if recent_runs.any? %>
    <div style="background-color: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
      <h3 style="margin-top: 0; margin-bottom: 15px;">Recent Runs</h3>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background-color: #e5e7eb; border-bottom: 2px solid #d1d5db;">
            <th style="padding: 8px; text-align: left; font-size: 14px;">ID</th>
            <th style="padding: 8px; text-align: left; font-size: 14px;">Status</th>
            <th style="padding: 8px; text-align: left; font-size: 14px;">Run After</th>
            <th style="padding: 8px; text-align: left; font-size: 14px;">Started</th>
            <th style="padding: 8px; text-align: left; font-size: 14px;">Duration</th>
          </tr>
        </thead>
        <tbody>
          <% recent_runs.each do |run| %>
            <tr style="border-bottom: 1px solid #e5e7eb;">
              <td style="padding: 8px; font-size: 14px;"><%= run.id %></td>
              <td style="padding: 8px;">
                <span style="padding: 3px 6px; border-radius: 4px; font-size: 11px; font-weight: 600; 
                  <%= case run.status
                      when 'success' then 'background-color: #d1fae5; color: #065f46;'
                      when 'failed' then 'background-color: #fee2e2; color: #991b1b;'
                      when 'in_progress' then 'background-color: #dbeafe; color: #1e40af;'
                      when 'pending' then 'background-color: #fef3c7; color: #92400e;'
                      else 'background-color: #f3f4f6; color: #374151;'
                      end %>">
                  <%= run.status.upcase %>
                </span>
              </td>
              <td style="padding: 8px; font-size: 14px;">
                <%= run.run_after.strftime('%m/%d %H:%M') %>
              </td>
              <td style="padding: 8px; font-size: 14px;">
                <%= run.started_at ? run.started_at.strftime('%m/%d %H:%M') : '-' %>
              </td>
              <td style="padding: 8px; font-size: 14px;">
                <% if run.started_at && run.ended_at %>
                  <%= ((run.ended_at - run.started_at) * 1000).round %>ms
                <% else %>
                  -
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <div style="margin-top: 15px; text-align: right;">
        <%= link_to "View All Runs â†’", "/active_data_flow/data_flows/#{@data_flow.id}/data_flow_runs", style: "color: #3182ce; font-weight: 600;" %>
      </div>
    </div>
  <% end %>

  <div style="background-color: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <h3>Source Configuration</h3>
    <pre style="background-color: #1f2937; color: #f9fafb; padding: 15px; border-radius: 4px; overflow-x: auto;"><%= JSON.pretty_generate(@data_flow.source) %></pre>
  </div>

  <div style="background-color: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <h3>Sink Configuration</h3>
    <pre style="background-color: #1f2937; color: #f9fafb; padding: 15px; border-radius: 4px; overflow-x: auto;"><%= JSON.pretty_generate(@data_flow.sink) %></pre>
  </div>

  <div style="background-color: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <h3>Runtime Configuration</h3>
    <pre style="background-color: #1f2937; color: #f9fafb; padding: 15px; border-radius: 4px; overflow-x: auto;"><%= JSON.pretty_generate(@data_flow.runtime) %></pre>
  </div>

  <div style="margin-top: 30px;">
    <%= link_to "Edit", "/active_data_flow/data_flows/#{@data_flow.id}/edit", style: "color: #3182ce; margin-right: 15px;" %>
    <%= button_to @data_flow.status == 'active' ? 'Disable' : 'Enable', 
                  "/active_data_flow/data_flows/#{@data_flow.id}/toggle_status", 
                  method: :patch,
                  style: "display: inline; color: #f59e0b; font-weight: 600; margin-right: 15px;" %>
    <%= button_to "Delete", "/active_data_flow/data_flows/#{@data_flow.id}", 
                  method: :delete, 
                  data: { turbo_confirm: "Are you sure?" },
                  style: "display: inline; color: #dc2626; font-weight: 600;" %>
  </div>
</div>
